#!/usr/bin/env python

import sys

# HACK
sys.path.extend(['/vagrant', '/vagrant/env/lib/python2.7/site-packages'])

import argparse

from tot.db import TotDatabase
from tot.logger import read_logs


def import_logs(args):
    db = TotDatabase(args.db, reset=True)

    for log_file in args.log_files:
        db.load(read_logs(log_file))


def main(argv):

    # Command parser.
    parser = argparse.ArgumentParser()
    subparsers = parser.add_subparsers()

    parser.add_argument('--db', default='tot.db', help='database file')

    # import command
    parser_import = subparsers.add_parser(
        'import', help='import logs')
    parser_import.add_argument('log_files', nargs='*',
                               help='log files to import')
    parser_import.set_defaults(func=import_logs)

    # Parse arguments
    args = parser.parse_args(argv)
    args.func(args)

    return 0


if __name__ == '__main__':
    sys.exit(main(sys.argv[1:]))
